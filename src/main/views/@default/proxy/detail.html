{$layout}

<div style="padding-top:1em">
    <form class="ui form" autocomplete="off" onsubmit="return false">
    <h3>基础信息</h3>
    <table class="ui table selectable width30 definition">
        <tbody>
            <tr>
                <td class="title">代理说明</td>
                <td>{{proxy.description}}</td>
                <td class="two op"><a href="" v-on:click.prevent="editDescription()" title="修改"><i class="ui icon edit small"></i> </a></td>
            </tr>
        </tbody>
        <tr v-if="proxyDescriptionEditing">
            <td></td>
            <td>
                <input type="text" name="description" v-model="proxy.description"/>
            </td>
            <td>
                <a href="" v-on:click.prevent="editDescriptionSave()" title="保存"><i class="ui icon check circle"></i></a>
                <a href="" v-on:click.prevent="proxyDescriptionEditing = !proxyDescriptionEditing" title="取消"><i class="ui icon arrow left"></i></a>
            </td>
        </tr>
        <tr v-if="proxy.name.length == 0">
            <td>域名</td>
            <td colspan="2">
                <a class="disabled">[还没有绑定域名]</a>
            </td>
        </tr>
        <tbody v-if="proxy.name.length > 0" v-for="(name, index) in proxy.name">
            <tr v-if="index != editNameIndex">
                <td>域名</td>
                <td>
                    {{name}}
                </td>
                <td>
                    <a href="" v-on:click.prevent="editName(index, name)" title="修改"><i class="ui icon edit small"></i></a> &nbsp; <a href="" v-on:click.prevent="deleteName(index)" title="删除"><i class="ui icon remove small"></i></a>
                </td>
            </tr>
            <tr v-if="index == editNameIndex">
                <td></td>
                <td>
                    <input type="text" name="name" v-model="proxy.name[index]"/>
                </td>
                <td>
                    <a href="" v-on:click.prevent="editNameSave(index,name)" title="保存"><i class="ui icon check circle"></i></a>
                    <a href="" v-on:click.prevent="editNameCancel()" title="取消"><i class="ui icon arrow left"></i> </a>
                </td>
            </tr>
        </tbody>
        <tr v-if="nameAdding">
            <td></td>
            <td>
                <input type="text" name="name" v-model="newName"/>
            </td>
            <td>
                <a href="" v-on:click.prevent="addNameSave()" title="保存"><i class="ui icon check circle"></i></a>
                <a href="" v-on:click.prevent="nameAdding = false" title="取消"><i class="ui icon arrow left"></i> </a>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <a href="" v-on:click.prevent="addName()"><i class="ui icon plus circle"></i>新域名</a>
            </td>
            <td></td>
        </tr>
        <tr v-if="proxy.listen.length == 0">
            <td>监听地址</td>
            <td colspan="2"><a class="disabled">[还没有绑定监听地址]</a></td>
        </tr>
        <tbody v-for="(listen, index) in proxy.listen">
            <tr v-if="index != editListenIndex">
                <td>监听地址</td>
                <td>{{listen}}</td>
                <td><a href="" v-on:click.prevent="editListen(index, listen)" title="修改"><i class="ui icon edit small"></i></a> &nbsp; <a href="" v-on:click.prevent="deleteListen(index)" title="删除"><i class="ui icon remove small"></i></a></td>
            </tr>
            <tr v-if="index == editListenIndex">
                <td>监听地址</td>
                <td>
                    <input type="text" name="listen" v-model="proxy.listen[index]" />
                </td>
                <td>
                    <a href="" v-on:click.prevent="editListenSave(index,listen)" title="保存"><i class="ui icon check circle"></i></a>
                    <a href="" v-on:click.prevent="editListenIndex = -1" title="取消"><i class="ui icon arrow left"></i> </a>
                </td>
            </tr>
        </tbody>
        <tr v-if="listenAdding">
            <td></td>
            <td>
                <input type="text" name="listen" v-model="newListen"/>
            </td>
            <td>
                <a href="" v-on:click.prevent="addListenSave()" title="保存"><i class="ui icon check circle"></i></a>
                <a href="" v-on:click.prevent="listenAdding = false" title="取消"><i class="ui icon arrow left"></i> </a>
            </td>
        </tr>
        <tr>
            <td></td>
            <td colspan="2"><a href="" v-on:click.prevent="addListen()"><i class="ui icon plus circle"></i>新监听地址</a></td>
        </tr>
    </table>

    <!-- SSL 设置 -->
    <h3>SSL</h3>
    <table class="ui table selectable definition width35">
        <tr>
            <td class="title">是否开启</td>
            <td colspan="2">
                <div class="ui toggle checkbox">
                    <input type="checkbox" :checked="proxy.ssl != null && proxy.ssl.on" v-on:click="switchSSLOn()"/>
                    <label></label>
                </div>
            </td>
        </tr>
        <tr v-if="!sslCertEditing">
            <td>证书文件</td>
            <td>
                <span v-if="proxy.ssl != null && proxy.ssl.certificate.length > 0">{{proxy.ssl.certificate}}</span>
                <span v-if="proxy.ssl == null || proxy.ssl.certificate.length == 0">[还没有上传密钥文件]</span>
            </td>
            <td class="two op">
                <a href="" v-on:click.prevent="sslCertEditing = !sslCertEditing" title="修改"><i class="ui icon edit small"></i></a>
            </td>
        </tr>
        <tr v-if="sslCertEditing">
            <td>证书文件</td>
            <td>
                <input type="file" name="sslCertFile" v-on:change="changeSSLCertFile" accept="application/x-pem-file, application/pkcs10, application/x-pkcs12, application/x-x509-user-cert, application/x-x509-ca-cert, application/pkix-cert"/>
            </td>
            <td class="two op">
                <a href="" v-on:click.prevent="uploadSSLCertFile()" title="上传"><i class="ui icon check circle"></i></a>
                <a href="" v-on:click.prevent="sslCertEditing = !sslCertEditing" title="取消"><i class="ui icon arrow left"></i></a>
            </td>
        </tr>
        <tr v-if="!sslKeyEditing">
            <td>密钥文件</td>
            <td>
                <span v-if="proxy.ssl != null && proxy.ssl.certificateKey.length > 0">{{proxy.ssl.certificateKey}}</span>
                <span v-if="proxy.ssl == null || proxy.ssl.certificateKey.length == 0">[还没有上传密钥文件]</span>
            </td>
            <td>
                <a href="" v-on:click.prevent="sslKeyEditing = !sslKeyEditing" title="修改"><i class="ui icon edit small"></i></a>
            </td>
        </tr>
        <tr v-if="sslKeyEditing">
            <td>密钥文件</td>
            <td>
                <input type="file" name="sslKeyFile" v-on:change="changeSSLKeyFile" accept="application/pkcs8"/>
            </td>
            <td class="two op">
                <a href="" v-on:click.prevent="uploadSSLKeyFile()" title="上传"><i class="ui icon check circle"></i></a>
                <a href="" v-on:click.prevent="sslKeyEditing = !sslKeyEditing" title="取消"><i class="ui icon arrow left"></i></a>
            </td>
        </tr>
    </table>

    <h3>后端服务器</h3>
    <table class="ui table selectable width30 definition">
        <tbody v-if="proxy.backends.length == 0">
            <tr>
                <td colspan="3">
                    <a class="disabled">[暂时还没有后端服务器]</a>
                </td>
            </tr>
        </tbody>
        <tbody v-if="proxy.backends.length > 0" v-for="(backend, index) in proxy.backends">
            <tr v-if="!backend.isEditing">
                <td class="title">后端服务器</td>
                <td>{{backend.address}}</td>
                <td class="two op">
                    <a href="" title="修改" v-on:click.prevent="editBackend(index, backend)"><i class="ui icon edit small"></i> </a>
                    <a href="" title="删除" v-on:click.prevent="deleteBackend(index)"><i class="ui icon remove small"></i> </a>
                </td>
            </tr>
            <tr v-if="backend.isEditing">
                <td>后端服务器</td>
                <td>
                    <input type="text" v-model="backend.address" />
                </td>
                <td class="two op">
                    <a href="" title="保存" v-on:click.prevent="editBackendSave(index, backend)"><i class="ui icon check circle"></i> </a>
                    <a href="" v-on:click.prevent="editBackendCancel(index, backend)" title="取消"><i class="ui icon arrow left"></i> </a>
                </td>
            </tr>
        </tbody>
        <tr v-if="backendAdding">
            <td></td>
            <td>
                    <div class="ui field">
                        <label>地址</label>
                        <input type="text" v-model="newBackendAddress" placeholder="比如 x.x.x.x:80"/>
                    </div>
                    <div class="ui field">

                    </div>
            </td>
            <td>
                <a href="" v-on:click.prevent="addBackendSave()" title="保存"><i class="ui icon check circle"></i> </a>
                <a href="" v-on:click.prevent="backendAdding = false" title="取消"><i class="ui icon arrow left"></i> </a>
            </td>
        </tr>
        <tr>
            <td></td>
            <td colspan="2"><a href="" v-on:click.prevent="addBackend()"><i class="ui icon plus circle"></i>新后端服务器</a></td>
        </tr>
    </table>
    </form>
</div>